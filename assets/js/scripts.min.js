var build,i,fetchProducts,fetchProduct,productsUrl="assets/data/productlist.json",productUrl="assets/data/",loader,start,end,createUrl,imgWrapper=React.createClass({displayName:"renderImage",getInitialState:function(){return{activeImage:"/assets/icons/white.gif",activeAngle:0,loading:!0,windowWidth:document.documentElement.clientWidth,windowHeight:document.documentElement.clientHeight,inputText:"",x:document.documentElement.clientWidth/2,y:document.documentElement.clientHeight/5}},getProducts:function(){start=(new Date).getTime(),$.ajax({url:productsUrl,dataType:"json",success:function(a){this.setState({loading:!1,products:a.products}),console.log("products fetched!"),clearInterval(fetchProducts),end=(new Date).getTime(),console.log("product list fetched in",end-start,"ms")}.bind(this),error:function(a,b,c){console.error(productsUrl,b,c.toString())}.bind(this)})},getProduct:function(a){createUrl=productUrl+this.state.products[a].url,start=(new Date).getTime(),$.ajax({url:createUrl,dataType:"json",success:function(a){this.setState({loading:!1,productId:a.product,productData:a.product.data,activeImage:a.product.data[0].src,activeAngle:a.product.data[0].angle}),console.log("product images fetched!"),clearInterval(fetchProduct),end=(new Date).getTime(),console.log("product image list fetched in",end-start,"ms")}.bind(this),error:function(a,b,c){console.error(createUrl,b,c.toString())}.bind(this)})},componentDidMount:function(){this.hammer=new Hammer(React.findDOMNode(this.refs.canvas)),this.hammer.get("pan").set({threshold:0,direction:Hammer.DIRECTION_ALL}),this.hammer.on("panleft",this.panLeft),this.hammer.on("panright",this.panRight),this.draw(),fetchProducts=setInterval(this.getProducts,500),window.addEventListener("resize",this.scale)},handleSelect:function(){var a=this.refs.select.getDOMNode().value;fetchProduct=setInterval(this.getProduct(a),500)},componentWillUnmount:function(){this.hammer.off("panleft",this.panLeft),this.hammer.off("panright",this.panRight)},getContext:function(){return React.findDOMNode(this.refs.canvas).getContext("2d")},tick:function(){this._frameReady=!1,this.draw(),requestAnimationFrame(this.afterTick)},afterTick:function(){this._frameReady=!0,this._pendingTick&&(this._pendingTick=!1,this.batchedTick())},batchedTick:function(){return this._frameReady===!1?void(this._pendingTick=!0):void this.tick()},scale:function(){this.setState({windowWidth:document.documentElement.clientWidth,windowHeight:document.documentElement.clientHeight})},mapImages:function(a){if(this.state.productData)for(i=0;i<this.state.productData.length;i++)a===this.state.productData[i].angle&&(this.setState({activeImage:this.state.productData[i].src}),console.log("currently drawn:"),console.log("Image: "+this.state.productData[i].src),console.log("Angle: "+a))},panRight:function(a){this.state.activeAngle>0?(this.setState({activeAngle:this.state.activeAngle-24}),this.mapImages(this.state.activeAngle)):(this.setState({activeAngle:360}),this.mapImages(360))},panLeft:function(a){this.state.activeAngle<360?(this.setState({activeAngle:this.state.activeAngle+24}),this.mapImages(this.state.activeAngle)):(this.setState({activeAngle:0}),this.mapImages(0))},incrementAngle:function(){this.state.activeAngle<360?(this.setState({activeAngle:this.state.activeAngle+24}),this.mapImages(this.state.activeAngle+24)):(this.setState({activeAngle:0}),this.mapImages(0))},decrementAngle:function(){this.state.activeAngle>0?(this.setState({activeAngle:this.state.activeAngle-24}),this.mapImages(this.state.activeAngle-24)):(this.setState({activeAngle:360}),this.mapImages(360))},draw:function(){this.clear(),this.updateProductImage(),this.updateProductText(),this.batchedTick()},clear:function(){this.getContext().clearRect(0,0,this.state.windowWidth,this.state.windowHeight)},updateProductImage:function(){var a;a=new Image,a.src=this.state.activeImage,this.setState({imgWidth:a.width,imgHeight:a.height}),this.getContext().drawImage(a,0,0)},handleInput:function(a){var b=a.target.value;this.setState({inputText:b})},positionElement:function(a){this.setState({x:a.srcEvent.pageX,y:a.srcEvent.pageY})},updateProductText:function(){this.getContext().save(),this.getContext().textAlign="center",this.getContext().font="14pt sans-serif",this.getContext().fillStyle="#f50",this.getContext().fillText(this.state.inputText,this.state.x,this.state.y),this.getContext().restore()},render:function(){var a,b=this.state.imgWidth,c=this.state.imgHeight;return loader=[],build=[],a=[],a.push(React.DOM.option({key:a.key,value:"select",style:{display:"none"}},"Select Product")),this.state.products&&this.state.products.forEach(function(b){a.push(React.DOM.option({key:b.key,value:b.id},b.slug))}),this.state.productData&&this.state.productData.forEach(function(a){build.push(React.DOM.img({key:"angle-"+a.angle,alt:"product-view-"+a.angle,src:a.src,"data-angle":a.angle}))}),this.state.loading===!0&&(loader.push(React.DOM.img({className:"loader",key:"loader-img",alt:"loader",src:"/assets/icons/ajax-loader.svg"})),loader.push(React.DOM.span({className:"loader-text",key:"loader-text"},"Loading Product View..."))),React.DOM.div({className:"image-container"},loader,React.DOM.div({className:"preload"},build),React.DOM.canvas({className:"playground",width:b,height:c,ref:"canvas"}),React.DOM.select({className:"select-product",ref:"select",onChange:this.handleSelect},a),React.DOM.button({onClick:this.incrementAngle,className:"button-right"},"R"),React.DOM.button({onClick:this.decrementAngle,className:"button-left"},"L"))}});React.render(React.createElement(imgWrapper),document.getElementById("main"));